<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>عرض العقارات</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 1rem;
    }

    .property {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 10px;
      margin-bottom: 1rem;
      padding: 1rem;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .property img {
      max-width: 100%;
      border-radius: 8px;
      margin-bottom: 0.5rem;
    }

    .share-btn {
      background-color: teal;
      color: white;
      border: none;
      padding: 0.4rem 0.8rem;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
    }

    .share-btn:hover {
      opacity: 0.9;
    }
  </style>
</head>
<body>
  <h2>إعلانات العقارات</h2>
  <div id="propertiesList"></div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script>
    // إعداد Firebase
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      databaseURL: "YOUR_DATABASE_URL",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function share(code, desc) {
      const text = `شاهد هذا الإعلان - كود: ${code}\n${desc}`;
      if (navigator.share) {
        navigator.share({
          title: "إعلان عقار",
          text: text
        }).catch(err => alert("حدث خطأ أثناء المشاركة: " + err));
      } else {
        alert("المشاركة غير مدعومة في هذا المتصفح.");
      }
    }

    function deleteProperty(code) {
      if (!confirm("هل أنت متأكد أنك تريد حذف هذا الإعلان نهائيًا؟")) return;

      db.ref("properties").once("value", snapshot => {
        snapshot.forEach(child => {
          if (child.val().code === code) {
            db.ref("properties/" + child.key).remove()
              .then(() => {
                alert("تم حذف الإعلان بنجاح.");
                displayProperties();
              })
              .catch(err => {
                alert("حدث خطأ أثناء الحذف: " + err.message);
              });
          }
        });
      });
    }

    function displayProperties() {
      const list = document.getElementById("propertiesList");
      list.innerHTML = "";

      db.ref("properties").once("value", snapshot => {
        snapshot.forEach(child => {
          const prop = child.val();
          const div = document.createElement("div");
          div.className = "property";
          div.innerHTML = `
            <img src="${prop.image}" alt="صورة العقار">
            <h4>${prop.type}</h4>
            <p><strong>الحي:</strong> ${prop.district}</p>
            <p><strong>السعر:</strong> ${prop.price}</p>
            <p><strong>الوصف:</strong> ${prop.desc}</p>
            <p><strong>الكود:</strong> ${prop.code}</p>
            <div style="margin-top: 0.5rem; display: flex; gap: 0.5rem;">
              <button class="share-btn" onclick="share('${prop.code}', '${prop.desc}')">مشاركة</button>
              <button class="share-btn" style="background-color: darkred;" onclick="deleteProperty('${prop.code}')">حذف</button>
            </div>
          `;
          list.appendChild(div);
        });
      });
    }

    displayProperties();
  </script>
</body>
</html>
